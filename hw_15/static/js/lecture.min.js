!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";function t(t,n){var o=this;o.element=t,o.el=e(t),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.enrichmentCache={},o.currentRequest=null,o.inputPhase=e.Deferred(),o.fetchPhase=e.Deferred(),o.enrichPhase=e.Deferred(),o.onChangeTimeout=null,o.triggering={},o.$wrapper=null,o.options=e.extend({},c,n),o.classes={hint:"suggestions-hint",mobile:"suggestions-mobile",nowrap:"suggestions-nowrap",selected:"suggestions-selected",suggestion:"suggestions-suggestion",subtext:"suggestions-subtext",subtext_inline:"suggestions-subtext suggestions-subtext_inline",subtext_delimiter:"suggestions-subtext-delimiter",subtext_label:"suggestions-subtext suggestions-subtext_label",removeConstraint:"suggestions-remove",value:"suggestions-value"},o.disabled=!1,o.selection=null,o.$viewport=e(window),o.$body=e(document.body),o.type=null,o.status={},o.setupElement(),o.initializer=e.Deferred(),o.el.is(":visible")?o.initializer.resolve():o.deferInitialization(),o.initializer.done(e.proxy(o.initialize,o))}var n={ENTER:13,ESC:27,TAB:9,SPACE:32,UP:38,DOWN:40},o={},i=".suggestions",s="suggestions",a="\\s\"'~\\*\\.,:\\|\\[\\]\\(\\)\\{\\}<>№",r=new RegExp("["+a+"]+","g"),u="\\-\\+\\/\\\\\\?!@#$%^&",l=new RegExp("["+u+"]+","g"),c={autoSelectFirst:!1,serviceUrl:null,onSearchStart:e.noop,onSearchComplete:e.noop,onSearchError:e.noop,onSuggestionsFetch:null,onSelect:null,onSelectNothing:null,onInvalidateSelection:null,minChars:1,deferRequestBy:100,params:{},paramName:"query",timeout:3e3,formatResult:null,formatSelected:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!1,triggerSelectOnEnter:!0,triggerSelectOnBlur:!0,preventBadQueries:!1,hint:"Выберите вариант или продолжите ввод",type:null,requestMode:"suggest",count:5,$helpers:null,headers:null,scrollOnFocus:!0,mobileWidth:980,initializeInterval:100},d={chains:{},on:function(e,t){return this.get(e).push(t),this},get:function(e){var t=this.chains;return t[e]||(t[e]=[])}},g=function(){var t=0;return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},escapeHtml:function(t){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return t&&e.each(n,function(e,n){t=t.replace(new RegExp(e,"g"),n)}),t},getDefaultType:function(){return e.support.cors?"POST":"GET"},getDefaultContentType:function(){return e.support.cors?"application/json":"application/x-www-form-urlencoded"},fixURLProtocol:function(t){return e.support.cors?t:t.replace(/^https?:/,location.protocol)},addUrlParams:function(t,n){return t+(/\?/.test(t)?"&":"?")+e.param(n)},serialize:function(t){return e.support.cors?JSON.stringify(t,function(e,t){return null===t?void 0:t}):e.param(t,!0)},compact:function(t){return e.grep(t,function(e){return!!e})},delay:function(e,t){return setTimeout(e,t||0)},uniqueId:function(e){return(e||"")+ ++t},slice:function(e,t){return Array.prototype.slice.call(e,t)},areSame:function t(n,o){var i=!0;return typeof n==typeof o&&("object"==typeof n&&null!=n&&null!=o?(e.each(n,function(e,n){return i=t(n,o[e])}),i):n===o)},arrayMinus:function(t,n){return n?e.grep(t,function(t,o){return-1===e.inArray(t,n)}):t},arrayMinusWithPartialMatching:function(t,n){return n?e.grep(t,function(e,t){return!n.some(function(t){return 0===t.indexOf(e)})}):t},getWords:function(e,t){e=e.replace(/(\d+)([а-яА-ЯёЁ]{2,})/g,"$1 $2").replace(/([а-яА-ЯёЁ]+)(\d+)/g,"$1 $2");var n=this.compact(e.split(r)),o=n.pop(),i=this.arrayMinus(n,t);return i.push(o),i},normalize:function(e,t){var n=this;return n.getWords(e,t).join(" ")},stringEncloses:function(e,t){return e.length>t.length&&-1!==e.indexOf(t)},fieldsNotEmpty:function(t,n){if(!e.isPlainObject(t))return!1;var o=!0;return e.each(n,function(e,n){return o=!!t[n]}),o},getDeepValue:function e(t,n){var o=n.split("."),i=o.shift();return t&&(o.length?e(t[i],o.join(".")):t[i])},reWordExtractor:function(){return new RegExp("([^"+a+"]*)(["+a+"]*)","g")},formatToken:function(e){return e&&e.toLowerCase().replace(/[ёЁ]/g,"е")},withSubTokens:function(t){var n=[];return e.each(t,function(e,t){var o=t.split(l);n.push(t),o.length>1&&(n=n.concat(g.compact(o)))}),n}}}(),p=function(){function t(t){return function(n){if(0===n.length)return!1;if(1===n.length)return!0;var o=t(n[0].value),i=e.grep(n,function(e){return 0===t(e.value).indexOf(o)},!0);return 0===i.length}}var n=t(function(e){return e}),o=t(function(e){return e.replace(/, (?:д|вл|двлд|к) .+$/,"")});return{matchByNormalizedQuery:function(t,n){var o=t.toLowerCase(),i=this&&this.stopwords,s=g.normalize(o,i),a=[];return e.each(n,function(e,t){var n=t.value.toLowerCase();return!g.stringEncloses(o,n)&&(!(n.indexOf(s)>0)&&void(s===g.normalize(n,i)&&a.push(e)))}),1===a.length?a[0]:-1},matchByWords:function(t,o){var i,s=this&&this.stopwords,a=t.toLowerCase(),r=[];return n(o)&&(i=g.withSubTokens(g.getWords(a,s)),e.each(o,function(e,t){var n=t.value.toLowerCase();if(g.stringEncloses(a,n))return!1;var o=g.withSubTokens(g.getWords(n,s));0===g.arrayMinus(i,o).length&&r.push(e)})),1===r.length?r[0]:-1},matchByWordsAddress:function(t,n){var i,s=this&&this.stopwords,a=t.toLowerCase(),r=-1;return o(n)&&(i=g.withSubTokens(g.getWords(a,s)),e.each(n,function(e,t){var n=t.value.toLowerCase();if(g.stringEncloses(a,n))return!1;var o=g.withSubTokens(g.getWords(n,s));return 0===g.arrayMinus(i,o).length?(r=e,!1):void 0})),r},matchByFields:function(t,n){var o=this&&this.stopwords,i=this&&this.fieldsStopwords,s=g.withSubTokens(g.getWords(t.toLowerCase(),o)),a=[];return 1===n.length&&(i&&e.each(i,function(e,t){var o=g.getDeepValue(n[0],e),i=o&&g.withSubTokens(g.getWords(o.toLowerCase(),t));i&&i.length&&(a=a.concat(i))}),0===g.arrayMinusWithPartialMatching(s,a).length)?0:-1}}}();!function(){function t(e,t){var n=e.data&&e.data[t];return n&&new RegExp("^"+g.escapeRegExChars(n)+"(["+a+"]|$)","i").test(e.value)}function n(e,t){return r.test(t)&&!r.test(e)?t:e}function i(e,t,o,i,s){var a=this,r=a.highlightMatches(e,o,i,s),u=a.highlightMatches(t,o,i,s);return n(r,u)}var s=["ао","аобл","дом","респ","а/я","аал","автодорога","аллея","арбан","аул","б-р","берег","бугор","вал","вл","волость","въезд","высел","г","городок","гск","д","двлд","днп","дор","дп","ж/д_будка","ж/д_казарм","ж/д_оп","ж/д_платф","ж/д_пост","ж/д_рзд","ж/д_ст","жилзона","жилрайон","жт","заезд","заимка","зона","к","казарма","канал","кв","кв-л","км","кольцо","комн","кордон","коса","кп","край","линия","лпх","м","массив","местность","мкр","мост","н/п","наб","нп","обл","округ","остров","оф","п","п/о","п/р","п/ст","парк","пгт","пер","переезд","пл","пл-ка","платф","погост","полустанок","починок","пр-кт","проезд","промзона","просек","просека","проселок","проток","протока","проулок","р-н","рзд","россия","рп","ряды","с","с/а","с/мо","с/о","с/п","с/с","сад","сквер","сл","снт","спуск","ст","ст-ца","стр","тер","тракт","туп","у","ул","уч-к","ф/х","ферма","х","ш","бульвар","владение","выселки","гаражно-строительный","город","деревня","домовладение","дорога","квартал","километр","комната","корпус","литер","леспромхоз","местечко","микрорайон","набережная","область","переулок","платформа","площадка","площадь","поселение","поселок","проспект","разъезд","район","республика","село","сельсовет","слобода","сооружение","станица","станция","строение","территория","тупик","улица","улус","участок","хутор","шоссе"],r=/<strong>/,u={LEGAL:[2,2,5,1],INDIVIDUAL:[2,2,6,2]};o.NAME={urlSuffix:"fio",matchers:[p.matchByNormalizedQuery,p.matchByWords],fieldNames:{surname:"фамилия",name:"имя",patronymic:"отчество"},alwaysContinueSelecting:!0,isDataComplete:function(n){var o,i=this,s=i.options.params,a=n.data;return e.isFunction(s)&&(s=s.call(i.element,n.value)),s&&s.parts?o=e.map(s.parts,function(e){return e.toLowerCase()}):(o=["surname","name"],t(n,"surname")&&o.push("patronymic")),g.fieldsNotEmpty(a,o)},composeValue:function(e){return g.compact([e.surname,e.name,e.patronymic]).join(" ")}},o.ADDRESS={urlSuffix:"address",matchers:[e.proxy(p.matchByNormalizedQuery,{stopwords:s}),e.proxy(p.matchByWordsAddress,{stopwords:s})],boundsAvailable:["region","area","city","settlement","street","house"],boundsFields:{region:["region","region_type","region_type_full","region_with_type"],area:["area","area_type","area_type_full","area_with_type"],city:["city","city_type","city_type_full","city_with_type"],settlement:["settlement","settlement_type","settlement_type_full","settlement_with_type"],street:["street","street_type","street_type_full","street_with_type"],house:["house","house_type","house_type_full","block","block_type"]},unformattableTokens:s,enrichmentEnabled:!0,geoEnabled:!0,isDataComplete:function(t){var n=[this.bounds.to||"flat"],o=t.data;return!e.isPlainObject(o)||g.fieldsNotEmpty(o,n)},composeValue:function(e){return g.compact([e.region_with_type||g.compact([e.region,e.region_type]).join(" "),e.area_with_type||g.compact([e.area_type,e.area]).join(" "),e.city_with_type||g.compact([e.city_type,e.city]).join(" "),e.settlement_with_type||g.compact([e.settlement_type,e.settlement]).join(" "),e.street_with_type||g.compact([e.street_type,e.street]).join(" "),g.compact([e.house_type,e.house,e.block_type,e.block]).join(" "),g.compact([e.flat_type,e.flat]).join(" "),e.postal_box?"а/я "+e.postal_box:null]).join(", ")}},o.PARTY={urlSuffix:"party",matchers:[e.proxy(p.matchByFields,{fieldsStopwords:{value:null,"data.address.value":s,"data.inn":null,"data.ogrn":null}})],geoEnabled:!0,formatResult:function(e,t,o,r){var u=this,l=u.type.formatResultInn.call(u,o,t),c=u.highlightMatches(g.getDeepValue(o.data,"ogrn"),t,o),d=n(l,c),p=u.highlightMatches(g.getDeepValue(o.data,"management.name"),t,o),h=g.getDeepValue(o.data,"address.value")||"";return u.isMobile&&((r||(r={})).maxLength=50),e=i.call(u,e,g.getDeepValue(o.data,"name.latin"),t,o,r),e=u.wrapFormattedValue(e,o),h&&(h=h.replace(/^(\d{6}?\s+|Россия,\s+)/i,""),h=u.isMobile?h.replace(new RegExp("^([^"+a+"]+["+a+"]+[^"+a+"]+).*"),"$1"):u.highlightMatches(h,t,o,{unformattableTokens:s})),(d||h||p)&&(e+='<div class="'+u.classes.subtext+'"><span class="'+u.classes.subtext_inline+'">'+(d||"")+"</span>"+(n(h,p)||"")+"</div>"),e},formatResultInn:function(t,n){var o,i,s=this,a=t.data&&t.data.inn,r=u[t.data&&t.data.type],l=/\d/;return a?(i=s.highlightMatches(a,n,t),r&&(i=i.split(""),o=e.map(r,function(e){for(var t,n="";e&&(t=i.shift());)n+=t,l.test(t)&&e--;return n}),i=o.join('<span class="'+s.classes.subtext_delimiter+'"></span>')+i.join("")),i):void 0}},o.EMAIL={urlSuffix:"email",matchers:[p.matchByNormalizedQuery],isQueryRequestable:function(e){return this.options.suggest_local||e.indexOf("@")>=0}},o.BANK={urlSuffix:"bank",matchers:[e.proxy(p.matchByFields,{fieldsStopwords:{value:null,"data.bic":null}})],formatResult:function(e,t,n,o){var i=this,r=i.highlightMatches(g.getDeepValue(n.data,"bic"),t,n),u=g.getDeepValue(n.data,"address.value")||"";return e=i.highlightMatches(e,t,n,o),e=i.wrapFormattedValue(e,n),u&&(u=u.replace(/^\d{6}( РОССИЯ)?, /i,""),u=i.isMobile?u.replace(new RegExp("^([^"+a+"]+["+a+"]+[^"+a+"]+).*"),"$1"):i.highlightMatches(u,t,n,{unformattableTokens:s})),(r||u)&&(e+='<div class="'+i.classes.subtext+'"><span class="'+i.classes.subtext_inline+'">'+r+"</span>"+u+"</div>"),e},formatSelected:function(e){return g.getDeepValue(e,"data.name.payment")}},e.extend(c,{suggest_local:!0})}();var h={suggest:{defaultParams:{type:g.getDefaultType(),dataType:"json",contentType:g.getDefaultContentType()},addTypeInUrl:!0},detectAddressByIp:{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!1},status:{defaultParams:{type:"GET",dataType:"json"},addTypeInUrl:!0},findById:{defaultParams:{type:g.getDefaultType(),dataType:"json",contentType:g.getDefaultContentType()},addTypeInUrl:!0}},f={suggest:{method:"suggest",userSelect:!0,updateValue:!0,enrichmentEnabled:!0},findById:{method:"findById",userSelect:!1,updateValue:!1,enrichmentEnabled:!1}};t.utils=g,t.defaultOptions=c,t.version="16.6.1",e.Suggestions=t,t.prototype={initialize:function(){var e=this;e.uniqueId=g.uniqueId("i"),e.createWrapper(),e.notify("initialize"),e.bindWindowEvents(),e.setOptions(),e.fixPosition()},deferInitialization:function(){var e,t=this,n="mouseover focus keydown",o=function(){t.initializer.resolve(),t.enable()};t.initializer.always(function(){t.el.off(n,o),clearInterval(e)}),t.disabled=!0,t.el.on(n,o),e=setInterval(function(){t.el.is(":visible")&&o()},t.options.initializeInterval)},isInitialized:function(){return"resolved"===this.initializer.state()},dispose:function(){var e=this;e.initializer.reject(),e.notify("dispose"),e.el.removeData(s).removeClass("suggestions-input"),e.unbindWindowEvents(),e.removeWrapper(),e.el.trigger("suggestions-dispose")},notify:function(t){var n=this,o=g.slice(arguments,1);return e.map(d.get(t),function(e){return e.apply(n,o)})},createWrapper:function(){var t=this;t.$wrapper=e('<div class="suggestions-wrapper"/>'),t.el.after(t.$wrapper),t.$wrapper.on("mousedown"+i,e.proxy(t.onMousedown,t))},removeWrapper:function(){var t=this;t.$wrapper&&t.$wrapper.remove(),e(t.options.$helpers).off(i)},onMousedown:function(t){var n=this;t.preventDefault(),n.cancelBlur=!0,g.delay(function(){delete n.cancelBlur}),0==e(t.target).closest(".ui-menu-item").length&&g.delay(function(){e(document).one("mousedown",function(t){var o=n.el.add(n.$wrapper).add(n.options.$helpers);n.options.floating&&(o=o.add(n.$container)),o=o.filter(function(){return this===t.target||e.contains(this,t.target)}),o.length||n.hide()})})},bindWindowEvents:function(){var t=this,n=e.proxy(t.fixPosition,t);t.$viewport.on("resize"+i+t.uniqueId,n).on("scroll"+i+t.uniqueId,n)},unbindWindowEvents:function(){this.$viewport.off("resize"+i+this.uniqueId).off("scroll"+i+this.uniqueId)},scrollToTop:function(){var t=this,n=t.options.scrollOnFocus;n===!0&&(n=t.el),n instanceof e&&n.length>0&&e("body,html").animate({scrollTop:n.offset().top},"fast")},setOptions:function(t){var n=this;e.extend(n.options,t),e.each({type:o,requestMode:f},function(t,o){if(n[t]=o[n.options[t]],!n[t])throw n.disable(),"`"+t+"` option is incorrect! Must be one of: "+e.map(o,function(e,t){return'"'+t+'"'}).join(", ")}),e(n.options.$helpers).off(i).on("mousedown"+i,e.proxy(n.onMousedown,n)),n.isInitialized()&&n.notify("setOptions")},fixPosition:function(t){var n,o,i=this,s={};i.isMobile=i.$viewport.width()<=i.options.mobileWidth,i.isInitialized()&&(!t||"scroll"!=t.type||i.options.floating||i.isMobile)&&(i.$container.appendTo(i.options.floating?i.$body:i.$wrapper),i.notify("resetPosition"),i.el.css("paddingLeft",""),i.el.css("paddingRight",""),s.paddingLeft=parseFloat(i.el.css("paddingLeft")),s.paddingRight=parseFloat(i.el.css("paddingRight")),e.extend(s,i.el.offset()),s.borderTop="none"==i.el.css("border-top-style")?0:parseFloat(i.el.css("border-top-width")),s.borderLeft="none"==i.el.css("border-left-style")?0:parseFloat(i.el.css("border-left-width")),s.innerHeight=i.el.innerHeight(),s.innerWidth=i.el.innerWidth(),s.outerHeight=i.el.outerHeight(),s.componentsLeft=0,s.componentsRight=0,n=i.$wrapper.offset(),o={top:s.top-n.top,left:s.left-n.left},i.notify("fixPosition",o,s),s.componentsLeft>s.paddingLeft&&i.el.css("paddingLeft",s.componentsLeft+"px"),s.componentsRight>s.paddingRight&&i.el.css("paddingRight",s.componentsRight+"px"))},clearCache:function(){this.cachedResponse={},this.enrichmentCache={},this.badQueries=[]},clear:function(){var e=this;e.isInitialized()&&(e.clearCache(),e.currentValue="",e.selection=null,e.hide(),e.suggestions=[],e.el.val(""),e.el.trigger("suggestions-clear"),e.notify("clear"))},disable:function(){var e=this;e.disabled=!0,e.abortRequest(),e.visible&&e.hide()},enable:function(){this.disabled=!1},isUnavailable:function(){return this.disabled},update:function(){var e=this,t=e.el.val();e.isInitialized()&&(e.currentValue=t,e.isQueryRequestable(t)?e.updateSuggestions(t):e.hide())},setSuggestion:function(t){var n,o,i=this;e.isPlainObject(t)&&e.isPlainObject(t.data)&&(t=e.extend(!0,{},t),i.bounds.own.length&&(i.checkValueBounds(t),n=i.copyBoundedData(t.data,i.bounds.all),t.data.kladr_id&&(n.kladr_id=i.getBoundedKladrId(t.data.kladr_id,i.bounds.all)),t.data=n),o=i.getSuggestionValue(t)||"",i.currentValue=o,i.el.val(o),i.selection=t,i.suggestions=[t],i.abortRequest(),i.el.trigger("suggestions-set"))},fixData:function(){var t=this,n=t.extendedCurrentValue(),o=t.el.val(),i=e.Deferred();i.done(function(e){t.selectSuggestion(e,0,o,{hasBeenEnriched:!0}),t.el.trigger("suggestions-fixdata",e)}).fail(function(){t.selection=null,t.currentValue="",t.el.val(t.currentValue),t.el.trigger("suggestions-fixdata")}),t.isQueryRequestable(n)?(t.currentValue=n,t.getSuggestions(n,{count:1,from_bound:null,to_bound:null}).done(function(e){var t=e[0];t?i.resolve(t):i.reject()}).fail(function(){i.reject()})):i.reject()},extendedCurrentValue:function(){var t=this,n=t.getParentInstance(),o=n&&n.extendedCurrentValue(),i=e.trim(t.el.val());return g.compact([o,i]).join(" ")},getAjaxParams:function(n,o){var i=this,s=e.trim(i.options.token),a=e.trim(i.options.partner),r=i.options.serviceUrl,u=h[n],l=e.extend({timeout:i.options.timeout},u.defaultParams),c={};return/\/$/.test(r)||(r+="/"),r+=n,u.addTypeInUrl&&(r+="/"+i.type.urlSuffix),r=g.fixURLProtocol(r),e.support.cors?(s&&(c.Authorization="Token "+s),a&&(c["X-Partner"]=a),c["X-Version"]=t.version,l.headers||(l.headers={}),e.extend(l.headers,i.options.headers,c)):(s&&(c.token=s),a&&(c.partner=a),c.version=t.version,r=g.addUrlParams(r,c)),l.url=r,e.extend(l,o)},isQueryRequestable:function(e){var t,n=this;return t=e.length>=n.options.minChars,t&&n.type.isQueryRequestable&&(t=n.type.isQueryRequestable.call(n,e)),t},constructRequestParams:function(t,n){var o=this,i=o.options,s=e.isFunction(i.params)?i.params.call(o.element,t):e.extend({},i.params);return o.type.constructRequestParams&&e.extend(s,o.type.constructRequestParams.call(o)),e.each(o.notify("requestParams"),function(t,n){e.extend(s,n)}),s[i.paramName]=t,e.isNumeric(i.count)&&i.count>0&&(s.count=i.count),e.extend(s,n)},updateSuggestions:function(e){var t=this;t.fetchPhase=t.getSuggestions(e).done(function(n){t.assignSuggestions(n,e)})},getSuggestions:function(t,n,o){var i,s=this,a=s.options,r=o&&o.noCallbacks,u=o&&o.useEnrichmentCache,l=s.constructRequestParams(t,n),c=e.param(l||{}),d=e.Deferred();return i=s.cachedResponse[c],i&&e.isArray(i.suggestions)?d.resolve(i.suggestions):s.isBadQuery(t)?d.reject():r||a.onSearchStart.call(s.element,l)!==!1?s.doGetSuggestions(l).done(function(e){s.processResponse(e)&&t==s.currentValue?(a.noCache||(u?s.enrichmentCache[t]=e.suggestions[0]:(s.enrichResponse(e,t),s.cachedResponse[c]=e,a.preventBadQueries&&0===e.suggestions.length&&s.badQueries.push(t))),d.resolve(e.suggestions)):d.reject(),r||a.onSearchComplete.call(s.element,t,e.suggestions)}).fail(function(e,n,o){d.reject(),r||"abort"===n||a.onSearchError.call(s.element,t,e,n,o)}):d.reject(),d},doGetSuggestions:function(t){var n=this,o=e.ajax(n.getAjaxParams(n.requestMode.method,{data:g.serialize(t)}));return n.abortRequest(),n.currentRequest=o,n.notify("request"),o.always(function(){n.currentRequest=null,n.notify("request")}),o},isBadQuery:function(t){if(!this.options.preventBadQueries)return!1;var n=!1;return e.each(this.badQueries,function(e,o){return!(n=0===t.indexOf(o))}),n},abortRequest:function(){var e=this;e.currentRequest&&e.currentRequest.abort()},processResponse:function(t){var n,o=this;return!(!t||!e.isArray(t.suggestions))&&(o.verifySuggestionsFormat(t.suggestions),o.setUnrestrictedValues(t.suggestions),e.isFunction(o.options.onSuggestionsFetch)&&(n=o.options.onSuggestionsFetch.call(o.element,t.suggestions),e.isArray(n)&&(t.suggestions=n)),!0)},verifySuggestionsFormat:function(t){"string"==typeof t[0]&&e.each(t,function(e,n){t[e]={value:n,data:null}})},getSuggestionValue:function(t){var n,o=this,i=o.options.formatSelected||o.type.formatSelected;return e.isFunction(i)&&(n=i.call(o,t)),"string"==typeof n&&0!=n.length||(n=t.value),n},assignSuggestions:function(e,t){var n=this;n.suggestions=e,n.notify("assignSuggestions",t)},shouldRestrictValues:function(){var e=this;return e.options.restrict_value&&e.constraints&&1==Object.keys(e.constraints).length},setUnrestrictedValues:function(t){var n=this,o=n.shouldRestrictValues(),i=n.getFirstConstraintLabel();e.each(t,function(e,t){t.unrestricted_value||(t.unrestricted_value=o?i+", "+t.value:t.value)})},areSuggestionsSame:function(e,t){return e&&t&&e.value===t.value&&g.areSame(e.data,t.data)}},function(){var o={setupElement:function(){this.el.attr("autocomplete","off").addClass("suggestions-input").css("box-sizing","border-box")},bindElementEvents:function(){var t=this;t.el.on("keydown"+i,e.proxy(t.onElementKeyDown,t)),t.el.on(["keyup"+i,"cut"+i,"paste"+i,"input"+i].join(" "),e.proxy(t.onElementKeyUp,t)),t.el.on("blur"+i,e.proxy(t.onElementBlur,t)),t.el.on("focus"+i,e.proxy(t.onElementFocus,t))},unbindElementEvents:function(){this.el.off(i)},onElementBlur:function(){var e=this;return e.cancelBlur?void(e.cancelBlur=!1):(e.options.triggerSelectOnBlur?e.isUnavailable()||e.selectCurrentValue({noSpace:!0}).always(function(){e.hide()}):e.hide(),void(e.fetchPhase.abort&&e.fetchPhase.abort()))},onElementFocus:function(){var t=this;t.cancelFocus||g.delay(e.proxy(t.completeOnFocus,t)),t.cancelFocus=!1},onElementKeyDown:function(e){var t=this;if(!t.isUnavailable())if(t.visible){switch(e.which){case n.ESC:t.el.val(t.currentValue),t.hide(),t.abortRequest();break;case n.TAB:if(t.options.tabDisabled===!1)return;break;case n.ENTER:t.options.triggerSelectOnEnter&&t.selectCurrentValue();break;case n.SPACE:return void(t.options.triggerSelectOnSpace&&t.isCursorAtEnd()&&(e.preventDefault(),t.selectCurrentValue({continueSelecting:!0,dontEnrich:!0}).fail(function(){t.currentValue+=" ",t.el.val(t.currentValue),t.proceedChangedValue()})));case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}else switch(e.which){case n.DOWN:t.suggest();break;case n.ENTER:t.options.triggerSelectOnEnter&&t.triggerOnSelectNothing()}},onElementKeyUp:function(e){var t=this;if(!t.isUnavailable()){switch(e.which){case n.UP:case n.DOWN:case n.ENTER:return}clearTimeout(t.onChangeTimeout),t.inputPhase.reject(),t.currentValue!==t.el.val()&&t.proceedChangedValue()}},proceedChangedValue:function(){var t=this;t.abortRequest(),t.inputPhase=e.Deferred().done(e.proxy(t.onValueChange,t)),t.options.deferRequestBy>0?t.onChangeTimeout=g.delay(function(){t.inputPhase.resolve()},t.options.deferRequestBy):t.inputPhase.resolve()},onValueChange:function(){var e,t=this;t.selection&&(e=t.selection,t.selection=null,t.trigger("InvalidateSelection",e)),t.selectedIndex=-1,t.update(),t.notify("valueChange")},completeOnFocus:function(){var e=this;e.isUnavailable()||e.isElementFocused()&&(e.fixPosition(),e.update(),e.isMobile&&(e.setCursorAtEnd(),e.scrollToTop()))},isElementFocused:function(){return document.activeElement===this.element},isCursorAtEnd:function(){var e,t,n=this,o=n.el.val().length;try{if(e=n.element.selectionStart,"number"==typeof e)return e===o}catch(e){}return!document.selection||(t=document.selection.createRange(),t.moveStart("character",-o),o===t.text.length)},setCursorAtEnd:function(){var e=this.element;try{e.selectionEnd=e.selectionStart=e.value.length,e.scrollLeft=e.scrollWidth}catch(t){e.value=e.value}}};e.extend(t.prototype,o),d.on("initialize",o.bindElementEvents).on("dispose",o.unbindElementEvents)}(),function(){function n(){e.each(o,function(){this.abort()}),o={}}var o={};n();var i={checkStatus:function(){function t(t){e.isFunction(n.options.onSearchError)&&n.options.onSearchError.call(n.element,null,a,"error",t)}var n=this,i=e.trim(n.options.token),s=n.options.type+i,a=o[s];a||(a=o[s]=e.ajax(n.getAjaxParams("status"))),a.done(function(o){o.search?e.extend(n.status,o):t("Service Unavailable")}).fail(function(){t(a.statusText)})}};t.resetTokens=n,e.extend(t.prototype,i),d.on("setOptions",i.checkStatus)}(),function(){function n(){o=null,t.defaultOptions.geoLocation=i}if("GET"!=g.getDefaultType()){var o,i=!0,s={checkLocation:function(){var t=this,n=t.options.geoLocation;t.type.geoEnabled&&n&&(t.geoLocation=e.Deferred(),e.isPlainObject(n)||e.isArray(n)?t.geoLocation.resolve(n):(o||(o=e.ajax(t.getAjaxParams("detectAddressByIp"))),o.done(function(e){var n=e&&e.location&&e.location.data;n&&n.kladr_id?t.geoLocation.resolve(n):t.geoLocation.reject()}).fail(function(){t.geoLocation.reject()})))},getGeoLocation:function(){return this.geoLocation},constructParams:function(){var t=this,n={};return t.geoLocation&&e.isFunction(t.geoLocation.promise)&&"resolved"==t.geoLocation.state()&&t.geoLocation.done(function(t){n.locations_boost=e.makeArray(t)}),n}};e.extend(c,{geoLocation:i}),e.extend(t,{resetLocation:n}),e.extend(t.prototype,{getGeoLocation:s.getGeoLocation}),d.on("setOptions",s.checkLocation).on("requestParams",s.constructParams)}}(),function(){var n={enrichSuggestion:function(t,n){var o=this,i=e.Deferred();return!o.status.enrich||!o.type.enrichmentEnabled||!o.requestMode.enrichmentEnabled||n&&n.dontEnrich?i.resolve(t):t.data&&null!=t.data.qc?i.resolve(t):(o.disableDropdown(),o.currentValue=t.unrestricted_value,o.enrichPhase=o.getSuggestions(t.unrestricted_value,{count:1,locations:null,locations_boost:null,from_bound:null,to_bound:null},{noCallbacks:!0,useEnrichmentCache:!0}).always(function(){o.enableDropdown()}).done(function(e){var n=e&&e[0];i.resolve(n||t,!!n)}).fail(function(){i.resolve(t)}),i)},enrichResponse:function(t,n){var o=this,i=o.enrichmentCache[n];i&&e.each(t.suggestions,function(e,o){return o.value===n?(t.suggestions[e]=i,!1):void 0})}};e.extend(t.prototype,n)}(),function(){function n(t){return e.map(t,function(e){var t=g.escapeHtml(e.text);return t&&e.matched&&(t="<strong>"+t+"</strong>"),t}).join("")}function o(t,n){var o=t.split(", ");return 1===o.length?t:e.map(o,function(e){return'<span class="'+n+'">'+e+"</span>"}).join(", ")}function s(t,n){var o=!1;return e.each(t,function(e,t){return o=t.value==n.value&&t!=n,!o&&void 0}),o}var a={width:"auto",floating:!1},l={createContainer:function(){var t=this,n="."+t.classes.suggestion,o=t.options,s=e("<div/>").addClass(o.containerClass).css({position:"absolute",display:"none"});t.$container=s,s.on("click"+i,n,e.proxy(t.onSuggestionClick,t))},removeContainer:function(){var e=this;e.options.floating&&e.$container.remove()},setContainerOptions:function(){var t=this,n="mousedown"+i;t.$container.off(n),t.options.floating&&t.$container.on(n,e.proxy(t.onMousedown,t))},onSuggestionClick:function(t){var n,o=this,i=e(t.target);if(!o.dropdownDisabled){for(o.cancelFocus=!0,o.el.focus();i.length&&!(n=i.attr("data-index"));)i=i.closest("."+o.classes.suggestion);n&&!isNaN(n)&&o.select(+n)}},setDropdownPosition:function(e,t){var n,o=this,i=o.$viewport.scrollLeft();o.isMobile?(n=o.options.floating?{left:i+"px",top:t.top+t.outerHeight+"px"}:{left:e.left-t.left+i+"px",top:e.top+t.outerHeight+"px"},n.width=o.$viewport.width()+"px"):(n=o.options.floating?{left:t.left+"px",top:t.top+t.borderTop+t.innerHeight+"px"}:{left:e.left+"px",top:e.top+t.borderTop+t.innerHeight+"px"},g.delay(function(){var e=o.options.width;"auto"===e&&(e=o.el.outerWidth()),o.$container.outerWidth(e)})),o.$container.toggleClass(o.classes.mobile,o.isMobile).css(n),o.containerItemsPadding=t.left+t.borderLeft+t.paddingLeft-i},setItemsPositions:function(){var e=this,t=e.getSuggestionsItems();t.css("paddingLeft",e.isMobile?e.containerItemsPadding+"px":"")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(e){this.dropdownDisabled=!e,this.$container.attr("disabled",!e)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var t=this;return t.suggestions.length>1||1===t.suggestions.length&&(!t.selection||e.trim(t.suggestions[0].value)!==e.trim(t.selection.value))},suggest:function(){var t,n,o=this,i=o.options;if(o.requestMode.userSelect){if(!o.hasSuggestionsToChoose())return void o.hide();t=i.formatResult||o.type.formatResult||o.formatResult,n=[],!o.isMobile&&i.hint&&o.suggestions.length&&n.push('<div class="'+o.classes.hint+'">'+i.hint+"</div>"),o.selectedIndex=-1,e.each(o.suggestions,function(e,i){var s=o.makeSuggestionLabel(o.suggestions,i);i==o.selection&&(o.selectedIndex=e),n.push('<div class="'+o.classes.suggestion+'" data-index="'+e+'">'),n.push(t.call(o,i.value,o.currentValue,i,{unformattableTokens:o.type.unformattableTokens})),s&&n.push('<span class="'+o.classes.subtext_label+'">'+g.escapeHtml(s)+"</span>"),n.push("</div>")}),o.$container.html(n.join("")),i.autoSelectFirst&&-1===o.selectedIndex&&(o.selectedIndex=0),-1!==o.selectedIndex&&o.getSuggestionsItems().eq(o.selectedIndex).addClass(o.classes.selected),e.isFunction(i.beforeRender)&&i.beforeRender.call(o.element,o.$container),o.$container.show(),o.visible=!0,o.fixPosition(),o.setItemsPositions()}},wrapFormattedValue:function(e,t){var n=this,o=g.getDeepValue(t.data,"state.status");return'<span class="'+n.classes.value+'"'+(o?' data-suggestion-status="'+o+'"':"")+">"+e+"</span>"},formatResult:function(e,t,n,o){var i=this;return e=i.highlightMatches(e,t,n,o),i.wrapFormattedValue(e,n)},highlightMatches:function(t,i,s,a){var l,c,d,p,h,f,v,m=this,y=[],b=a&&a.unformattableTokens,x=a&&a.maxLength,w=g.reWordExtractor();if(!t)return"";for(l=g.formatToken(i).split(r),l=g.withSubTokens(l),c=e.map(l,function(e){return new RegExp("^((.*)(["+u+"]+))?("+g.escapeRegExChars(e)+")([^"+u+"]*["+u+"]*)","i")});(d=w.exec(t))&&d[0];)p=d[1],y.push({text:p,inUpperCase:p.toLowerCase()!==p,formatted:g.formatToken(p),matchable:!0}),d[2]&&y.push({text:d[2]});for(h=0;h<y.length;h++)f=y[h],!f.matchable||f.matched||-1!==e.inArray(f.formatted,b)&&!f.inUpperCase||e.each(c,function(e,t){var n,o=t.exec(f.formatted),i=h+1;return o?(o={before:o[1]||"",beforeText:o[2]||"",beforeDelimiter:o[3]||"",text:o[4]||"",after:o[5]||""},o.before&&(y.splice(h,0,{text:f.text.substr(0,o.beforeText.length),formatted:o.beforeText,matchable:!0},{text:o.beforeDelimiter}),i+=2,n=o.before.length,f.text=f.text.substr(n),f.formatted=f.formatted.substr(n),h--),n=o.text.length+o.after.length,f.formatted.length>n&&(y.splice(i,0,{text:f.text.substr(n),formatted:f.formatted.substr(n),matchable:!0}),f.text=f.text.substr(0,n),f.formatted=f.formatted.substr(0,n)),o.after&&(n=o.text.length,y.splice(i,0,{text:f.text.substr(n),formatted:f.formatted.substr(n)}),f.text=f.text.substr(0,n),f.formatted=f.formatted.substr(0,n)),f.matched=!0,!1):void 0});if(x){for(h=0;h<y.length&&x>=0;h++)f=y[h],x-=f.text.length,0>x&&(f.text=f.text.substr(0,f.text.length+x)+"...");y.length=h}return v=n(y),o(v,m.classes.nowrap)},makeSuggestionLabel:function(t,n){var o,i,a=this,r=a.type.fieldNames,u={},l=g.reWordExtractor(),c=[];if(r&&s(t,n)&&n.data&&(e.each(r,function(e){var t=n.data[e];t&&(u[e]=g.formatToken(t))}),!e.isEmptyObject(u))){for(;(o=l.exec(g.formatToken(n.value)))&&(i=o[1]);)e.each(u,function(e,t){return t==i?(c.push(r[e]),delete u[e],!1):void 0});if(c.length)return c.join(", ")}},hide:function(){var e=this;e.visible=!1,e.selectedIndex=-1,e.$container.hide().empty()},activate:function(e){var t,n,o=this,i=o.classes.selected;return!o.dropdownDisabled&&(n=o.getSuggestionsItems(),n.removeClass(i),o.selectedIndex=e,-1!==o.selectedIndex&&n.length>o.selectedIndex)?(t=n.eq(o.selectedIndex),t.addClass(i),t):null},deactivate:function(e){var t=this;t.dropdownDisabled||(t.selectedIndex=-1,t.getSuggestionsItems().removeClass(t.classes.selected),e&&t.el.val(t.currentValue))},moveUp:function(){var e=this;if(!e.dropdownDisabled)return-1===e.selectedIndex?void(e.suggestions.length&&e.adjustScroll(e.suggestions.length-1)):0===e.selectedIndex?void e.deactivate(!0):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;if(!e.dropdownDisabled)return e.selectedIndex===e.suggestions.length-1?void e.deactivate(!0):void e.adjustScroll(e.selectedIndex+1);
},adjustScroll:function(e){var t,n,o,i=this,s=i.activate(e),a=i.$container.scrollTop();s&&s.length&&(t=s.position().top,0>t?i.$container.scrollTop(a+t):(n=t+s.outerHeight(),o=i.$container.innerHeight(),n>o&&i.$container.scrollTop(a-o+n)),i.el.val(i.suggestions[e].value))}};e.extend(c,a),e.extend(t.prototype,l),d.on("initialize",l.createContainer).on("dispose",l.removeContainer).on("setOptions",l.setContainerOptions).on("fixPosition",l.setDropdownPosition).on("fixPosition",l.setItemsPositions).on("assignSuggestions",l.suggest)}(),function(){var t="addon",n=50,o=1e3,i={addon:null},s={NONE:"none",SPINNER:"spinner",CLEAR:"clear"},a=function(t){var n=this,o=e('<span class="suggestions-addon"/>');n.owner=t,n.$el=o,n.type=s.NONE,n.visible=!1,n.initialPadding=null,o.on("click",e.proxy(n,"onClick"))};a.prototype={checkType:function(){var t=this,n=t.owner.options.addon,o=!1;e.each(s,function(e,t){return o=t==n,!o&&void 0}),o||(n=t.owner.isMobile?s.CLEAR:s.SPINNER),n!=t.type&&(t.type=n,t.$el.attr("data-addon-type",n),t.toggle(!0))},toggle:function(e){var t,n=this;switch(n.type){case s.CLEAR:t=!!n.owner.currentValue;break;case s.SPINNER:t=!!n.owner.currentRequest;break;default:t=!1}t!=n.visible&&(n.visible=t,t?n.show(e):n.hide(e))},show:function(e){var t=this,o={opacity:1};e?(t.$el.show().css(o),t.showBackground(!0)):t.$el.stop(!0,!0).delay(n).queue(function(){t.$el.show(),t.showBackground(),t.$el.dequeue()}).animate(o,"fast")},hide:function(e){var t=this,n={opacity:0};e&&t.$el.hide().css(n),t.$el.stop(!0).animate(n,{duration:"fast",complete:function(){t.$el.hide(),t.hideBackground()}})},fixPosition:function(e,t){var n=this,o=t.innerHeight;n.checkType(),n.$el.css({left:e.left+t.borderLeft+t.innerWidth-o+"px",top:e.top+t.borderTop+"px",height:o,width:o}),n.initialPadding=t.paddingRight,n.width=o,n.visible&&(t.componentsRight+=o)},showBackground:function(e){var n=this,o=n.owner.el,i={paddingRight:n.width};n.width>n.initialPadding&&(n.stopBackground(),e?o.css(i):o.animate(i,{duration:"fast",queue:t}).dequeue(t))},hideBackground:function(e){var n=this,i=n.owner.el,s={paddingRight:n.initialPadding};n.width>n.initialPadding&&(n.stopBackground(!0),e?i.css(s):i.delay(o,t).animate(s,{duration:"fast",queue:t}).dequeue(t))},stopBackground:function(e){this.owner.el.stop(t,!0,e)},onClick:function(e){var t=this;t.type==s.CLEAR&&t.owner.clear()}};var r={createAddon:function(){var e=this,t=new a(e);e.$wrapper.append(t.$el),e.addon=t},fixAddonPosition:function(e,t){this.addon.fixPosition(e,t)},checkAddonType:function(){this.addon.checkType()},checkAddonVisibility:function(){this.addon.toggle()},stopBackground:function(){this.addon.stopBackground()}};e.extend(c,i),d.on("initialize",r.createAddon).on("setOptions",r.checkAddonType).on("fixPosition",r.fixAddonPosition).on("clear",r.checkAddonVisibility).on("valueChange",r.checkAddonVisibility).on("request",r.checkAddonVisibility).on("resetPosition",r.stopBackground)}(),function(){function n(t){var n={};return e.isPlainObject(t)&&e.each(t,function(e,t){t&&s.indexOf(e)>=0&&(n[e]=t)}),e.isEmptyObject(n)?void 0:n.kladr_id?{kladr_id:n.kladr_id}:n}function o(t,n){var o=n.selection,i=o&&o.data&&n.bounds;return i&&e.each(n.bounds.all,function(e,n){return i=o.data[n]===t.data[n]}),i}var i={constraints:null,restrict_value:!1},s=["kladr_id","postal_code","country","region","area","city","settlement","street"],a={createConstraints:function(){var t=this;t.constraints={},t.$constraints=e('<ul class="suggestions-constraints"/>'),t.$wrapper.append(t.$constraints),t.$constraints.on("click","."+t.classes.removeConstraint,e.proxy(t.onConstraintRemoveClick,t))},setConstraintsPosition:function(e,t){var n=this;n.$constraints.css({left:e.left+t.borderLeft+t.paddingLeft+"px",top:e.top+t.borderTop+Math.round((t.innerHeight-n.$constraints.height())/2)+"px"}),t.componentsLeft+=n.$constraints.outerWidth(!0)+t.paddingLeft},onConstraintRemoveClick:function(t){var n=this,o=e(t.target).closest("li"),i=o.attr("data-constraint-id");delete n.constraints[i],n.update(),o.fadeOut("fast",function(){n.removeConstraint(i)})},setupConstraints:function(){var t,n=this,o=n.options.constraints;return o?void(o instanceof e||"string"==typeof o||"number"==typeof o.nodeType?(t=e(o),t.is(n.constraints)||(n.unbindFromParent(),t.is(n.el)||(n.constraints=t,n.bindToParent()))):(n._constraintsUpdating=!0,e.each(n.constraints,e.proxy(n.removeConstraint,n)),e.each(e.makeArray(o),function(e,t){n.addConstraint(t)}),n._constraintsUpdating=!1,n.fixPosition())):void n.unbindFromParent()},formatConstraint:function(t){var o,i=this;return t&&(t.locations||t.restrictions)?(o=e.makeArray(t.locations||t.restrictions),null==t.label&&i.type.composeValue&&(t.label=e.map(o,function(e){return i.type.composeValue(e)}).join(", ")),t.locations=[],e.each(o,function(e,o){var i=n(o);i&&t.locations.push(i)}),t.locations.length?t:null):void 0},addConstraint:function(t){var n,o,i=this;t=i.formatConstraint(t),t&&(o=g.uniqueId("c"),i.constraints[o]=t,t.label&&(n=e("<li/>").append(e("<span/>").text(t.label)).attr("data-constraint-id",o),t.deletable&&n.append(e('<span class="suggestions-remove"/>')),i.$constraints.append(n),i._constraintsUpdating||i.fixPosition()))},removeConstraint:function(e){var t=this;delete t.constraints[e],t.$constraints.children('[data-constraint-id="'+e+'"]').remove(),t._constraintsUpdating||t.fixPosition()},constructConstraintsParams:function(){for(var t,o,i=this,s=[],a=i.constraints,r={};a instanceof e&&(t=a.suggestions())&&!(o=g.getDeepValue(t,"selection.data"));)a=t.constraints;return a instanceof e?(o=n(o),o&&(r.locations=[o],r.restrict_value=!0)):a&&(e.each(a,function(e,t){s=s.concat(t.locations)}),s.length&&(r.locations=s,r.restrict_value=i.options.restrict_value)),r},getFirstConstraintLabel:function(){var t=this,n=e.isPlainObject(t.constraints)&&Object.keys(t.constraints)[0];return n?t.constraints[n].label:""},bindToParent:function(){var t=this;t.constraints.on(["suggestions-select."+t.uniqueId,"suggestions-invalidateselection."+t.uniqueId,"suggestions-clear."+t.uniqueId].join(" "),e.proxy(t.onParentSelectionChanged,t)).on("suggestions-dispose."+t.uniqueId,e.proxy(t.onParentDispose,t))},unbindFromParent:function(){var t=this,n=t.constraints;n instanceof e&&n.off("."+t.uniqueId)},onParentSelectionChanged:function(e,t,n){("suggestions-select"!==e.type||n)&&this.clear()},onParentDispose:function(e){this.unbindFromParent()},getParentInstance:function(){return this.constraints instanceof e&&this.constraints.suggestions()},shareWithParent:function(e){var t=this.getParentInstance();t&&t.type===this.type&&!o(e,t)&&(t.shareWithParent(e),t.setSuggestion(e))}};e.extend(c,i),e.extend(t.prototype,a),"GET"!=g.getDefaultType()&&d.on("initialize",a.createConstraints).on("setOptions",a.setupConstraints).on("fixPosition",a.setConstraintsPosition).on("requestParams",a.constructConstraintsParams).on("dispose",a.unbindFromParent)}(),function(){var n={proceedQuery:function(e){var t=this;e.length>=t.options.minChars?t.updateSuggestions(e):t.hide()},selectCurrentValue:function(t){var n=this,o=e.Deferred();return n.inputPhase.resolve(),n.fetchPhase.done(function(){var e;n.selection&&!n.visible?o.reject():(e=n.findSuggestionIndex(),n.select(e,t),-1===e?o.reject():o.resolve(e))}).fail(function(){o.reject()}),o},selectFoundSuggestion:function(){var e=this;e.requestMode.userSelect||e.select(0)},findSuggestionIndex:function(){var t,n=this,o=n.selectedIndex;return-1===o&&(t=e.trim(n.el.val()),t&&e.each(n.type.matchers,function(e,i){return o=i(t,n.suggestions),-1===o})),o},select:function(t,n){var o=this,i=o.suggestions[t],s=n&&n.continueSelecting,a=o.currentValue;if(!o.triggering.Select)return i?void o.enrichSuggestion(i,n).done(function(i,s){o.selectSuggestion(i,t,a,e.extend({hasBeenEnriched:s},n))}):(s||o.selection||o.triggerOnSelectNothing(),void o.onSelectComplete(s))},selectSuggestion:function(e,t,n,o){var i=this,s=o.continueSelecting,a=!i.type.isDataComplete||i.type.isDataComplete.call(i,e),r=i.selection;i.triggering.Select||(i.type.alwaysContinueSelecting&&(s=!0),a&&(s=!1),o.hasBeenEnriched&&i.suggestions[t]&&(i.suggestions[t].data=e.data),i.requestMode.updateValue&&(i.checkValueBounds(e),i.currentValue=i.getSuggestionValue(e),!i.currentValue||o.noSpace||a||(i.currentValue+=" "),i.el.val(i.currentValue)),i.currentValue?(i.selection=e,i.areSuggestionsSame(e,r)||i.trigger("Select",e,i.currentValue!=n),i.requestMode.userSelect&&i.onSelectComplete(s)):(i.selection=null,i.triggerOnSelectNothing()),i.shareWithParent(e))},onSelectComplete:function(e){var t=this;e?(t.selectedIndex=-1,t.updateSuggestions(t.currentValue)):t.hide()},triggerOnSelectNothing:function(){var e=this;e.triggering.SelectNothing||e.trigger("SelectNothing",e.currentValue)},trigger:function(t){var n=this,o=g.slice(arguments,1),i=n.options["on"+t];n.triggering[t]=!0,e.isFunction(i)&&i.apply(n.element,o),n.el.trigger.call(n.el,"suggestions-"+t.toLowerCase(),o),n.triggering[t]=!1}};e.extend(t.prototype,n),d.on("assignSuggestions",n.selectFoundSuggestion)}(),function(){var t={bounds:null},n={region:{digits:2,zeros:11},area:{digits:5,zeros:8},city:{digits:8,zeros:5},settlement:{digits:11,zeros:2},street:{digits:15,zeros:2},house:{digits:19}},o={setupBounds:function(){this.bounds={from:null,to:null}},setBoundsOptions:function(){var t,n,o=this,i=o.type.boundsAvailable,s=e.trim(o.options.bounds).split("-"),a=s[0],r=s[s.length-1],u=[],l=[];-1===e.inArray(a,i)&&(a=null),n=e.inArray(r,i),-1!==n&&n!==i.length-1||(r=null),(a||r)&&(t=!a,e.each(i,function(e,n){return n==a&&(t=!0),l.push(n),t&&u.push(n),n!=r&&void 0})),o.bounds.from=a,o.bounds.to=r,o.bounds.all=l,o.bounds.own=u},constructBoundsParams:function(){var e=this,t={};return e.bounds.from&&(t.from_bound={value:e.bounds.from}),e.bounds.to&&(t.to_bound={value:e.bounds.to}),t},checkValueBounds:function(e){var t,n=this;n.bounds.own.length&&n.type.composeValue&&(t=n.copyBoundedData(e.data,n.bounds.own),e.value=n.type.composeValue(t))},copyBoundedData:function(t,n){var o={},i=this.type.boundsFields;return i&&e.each(n,function(n,s){var a=i[s];a&&e.each(a,function(e,n){null!=t[n]&&(o[n]=t[n])})}),o},getBoundedKladrId:function(e,t){var o=t[t.length-1],i=n[o],s=e.substr(0,i.digits);return i.zeros&&(s+=new Array(i.zeros+1).join("0")),s}};e.extend(c,t),e.extend(e.Suggestions.prototype,o),d.on("initialize",o.setupBounds).on("setOptions",o.setBoundsOptions).on("requestParams",o.constructBoundsParams)}(),e.fn.suggestions=function(n,o){return 0===arguments.length?this.first().data(s):this.each(function(){var i=e(this),a=i.data(s);"string"==typeof n?a&&"function"==typeof a[n]&&a[n](o):(a&&a.dispose&&a.dispose(),a=new t(this,n),i.data(s,a))})}}),function(e){e.fn.kladrInline=function(t){var n=e.extend({serviceUrl:"https://api.bcs.ru/kladr/v3",type:"ADDRESS",token:"",input:"",flatRequired:!1,geoLocation:!0},t);return this.each(function(){var t=e(n.input,this),o=t.next("input"),i=t.parent().find(".js-kladr-inline-error"),s=t.parent().find(".js-kladr-inline-regname"),a=t.parent().find(".js-kladr-inline-regcode"),r=function(e,t){return""===e?void i.html(""):void i.html('<span class="_'+t+'">'+e+"</span>")};t.suggestions({serviceUrl:n.serviceUrl,token:n.token,type:n.type,autoSelectFirst:!0,hint:!1,mobileWidth:420,geoLocation:n.geoLocation,onSelect:function(e){var t=e.data;s.val(t.region),a.val(t.region_kladr_id),t.city||t.settlement?t.city&&!t.street?(r("Необходимо указать улицу","red"),o.val("").change()):t.city&&t.street&&!t.house?(r("Нужно указать номер дома","red"),o.val("").change()):t.city&&t.street&&t.house&&!t.flat?n.flatRequired?(r("Укажите номер квартиры","red"),o.val("").change()):(r("Укажите номер квартиры, если есть","gray"),o.val(e.value).change(),i.next().html("")):(r(""),o.val(e.value).change(),i.next().html("")):(r("Введите название населенного пункта","red"),o.val("").change())},onSelectNothing:function(){r(""),o.val("").change()}})})}}(jQuery),$(window).on("load",function(){$("#id_delivery_date").mask("99.99.9999",{placeholder:"dd.mm.yyyy"}),$(".js-kladr-inline-input").closest(".row").kladrInline({token:"574fec4e42aa48a2ac22841a3f6def1d",input:".js-kladr-inline-input",flatRequired:!1,geoLocation:!0})});